"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@transmute/did-key-ed25519"),t=e(require("jsonld")),o=e(require("crypto"));function n(){return(n=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)}function i(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var a=require("security-context").constants,c={SECURITY_CONTEXT_URL:a.SECURITY_CONTEXT_V2_URL,SECURITY_CONTEXT_V1_URL:a.SECURITY_CONTEXT_V1_URL,SECURITY_CONTEXT_V2_URL:a.SECURITY_CONTEXT_V2_URL,SECURITY_PROOF_URL:"https://w3id.org/security#proof",SECURITY_SIGNATURE_URL:"https://w3id.org/security#signature"},u=function(e){var r=o.createHash("sha256");return r.update(e),r.digest()},s=function(){function e(e){var t=this,o=this;void 0===e&&(e={}),this.useNativeCanonize=!1,this.type="Ed25519Signature2018",this.signer=e.signer,this.date=e.date,e.key&&(this.key=e.key,this.verificationMethod=this.key.id,this.signer={sign:function(e){var o=e.data;try{var n={alg:"EdDSA",b64:!1,crit:["b64"]},i=Buffer.from(o);return Promise.resolve(t.key.toJsonWebKeyPair(!0)).then((function(e){return Promise.resolve(r.EdDSA.signDetached(i,e.privateKeyJwk,n))}))}catch(e){return Promise.reject(e)}}},this.verifier={verify:function(e){var t=e.data,n=e.signature;try{var a=!1,c=i((function(){return Promise.resolve(r.EdDSA.verifyDetached(n,t,r.keyUtils.publicKeyJwkFromPublicKeyBase58(o.key.publicKeyBase58))).then((function(e){a=e}))}),(function(e){console.error("An error occurred when verifying signature: ",e)}));return Promise.resolve(c&&c.then?c.then((function(){return a})):a)}catch(e){return Promise.reject(e)}}})}var o=e.prototype;return o.canonize=function(e,r){var o=r.documentLoader,n=r.expansionMap,i=r.skipExpansion;try{return Promise.resolve(t.canonize(e,{algorithm:"URDNA2015",format:"application/n-quads",documentLoader:o,expansionMap:n,skipExpansion:i,useNative:this.useNativeCanonize}))}catch(e){return Promise.reject(e)}},o.canonizeProof=function(e,r){var t=r.documentLoader,o=r.expansionMap;try{return delete(e=n({},e)).jws,delete e.signatureValue,delete e.proofValue,Promise.resolve(this.canonize(e,{documentLoader:t,expansionMap:o,skipExpansion:!1}))}catch(e){return Promise.reject(e)}},o.createVerifyData=function(e){var r=e.document,t=e.proof,o=e.documentLoader,n=e.expansionMap;try{var i=this;return Promise.resolve(i.canonizeProof(t,{documentLoader:o,expansionMap:n})).then((function(e){return Promise.resolve(i.canonize(r,{documentLoader:o,expansionMap:n})).then((function(r){return Buffer.concat([u(e),u(r)])}))}))}catch(e){return Promise.reject(e)}},o.matchProof=function(e){var r=e.proof;try{return Promise.resolve(r.type===this.type)}catch(e){return Promise.reject(e)}},o.updateProof=function(e){return Promise.resolve(e.proof)},o.sign=function(e){var r=e.verifyData,t=e.proof;try{if(!this.signer||"function"!=typeof this.signer.sign)throw new Error("A signer API has not been specified.");return Promise.resolve(this.signer.sign({data:r})).then((function(e){return t.jws=e,t}))}catch(e){return Promise.reject(e)}},o.createProof=function(e){var r=e.document,o=e.purpose,n=e.documentLoader,i=e.expansionMap,a=e.compactProof;try{var u,s=function(){u.type=f.type;var e=f.date;return void 0===u.created&&void 0===e&&(e=new Date),void 0!==e&&"string"!=typeof e&&(e=new Date(e).toISOString()),void 0!==e&&(u.created=e),void 0!==f.verificationMethod&&(u.verificationMethod=f.verificationMethod),void 0!==f.creator&&(u.creator=f.creator),Promise.resolve(f.updateProof({document:r,proof:u,purpose:o,documentLoader:n,expansionMap:i,compactProof:a})).then((function(e){return u=e,Promise.resolve(o.update(u,{document:r,suite:f,documentLoader:n,expansionMap:i})).then((function(e){return u=e,Promise.resolve(f.createVerifyData({document:r,proof:u,documentLoader:n,expansionMap:i,compactProof:a})).then((function(e){return Promise.resolve(f.sign({verifyData:e,document:r,proof:u,documentLoader:n,expansionMap:i})).then((function(e){return u=e}))}))}))}))},f=this,d=function(){if(f.proof)return Promise.resolve(t.compact(f.proof,c.SECURITY_CONTEXT_URL,{documentLoader:n,expansionMap:i,compactToRelative:!1})).then((function(e){u=e}));u={"@context":c.SECURITY_CONTEXT_URL}}();return Promise.resolve(d&&d.then?d.then(s):s())}catch(e){return Promise.reject(e)}},o.getVerificationMethod=function(e){var r=e.proof,o=e.documentLoader;try{var n=r.verificationMethod;if(n||(n=r.creator),"object"==typeof n&&(n=n.id),!n)throw new Error('No "verificationMethod" or "creator" found in proof.');return Promise.resolve(t.frame(n,{"@context":c.SECURITY_CONTEXT_URL,"@embed":"@always",id:n},{documentLoader:o,compactToRelative:!1})).then((function(e){if(!e)throw new Error("Verification method "+n+" not found.");if(void 0!==e.revoked)throw new Error("The verification method has been revoked.");return e}))}catch(e){return Promise.reject(e)}},o.verifySignature=function(e){var t=e.verifyData,o=e.verificationMethod,n=e.proof;try{var a=function(){return c.verify({data:t,signature:n.jws})},c=this.verifier,u=function(){if(!c)return Promise.resolve(r.Ed25519KeyPair.from(o)).then((function(e){c={verify:function(t){var o=t.data,n=t.signature;try{var a=!1;return Promise.resolve(e.toJsonWebKeyPair(!1)).then((function(e){var t=e.publicKeyJwk,c=i((function(){return Promise.resolve(r.EdDSA.verifyDetached(n,o,t)).then((function(e){a=e}))}),(function(e){console.error("An error occurred when verifying signature: ",e)}));return c&&c.then?c.then((function(){return a})):a}))}catch(e){return Promise.reject(e)}}}}))}();return Promise.resolve(u&&u.then?u.then(a):a())}catch(e){return Promise.reject(e)}},o.verifyProof=function(e){var r=e.proof,t=e.document,o=e.purpose,n=e.documentLoader,a=e.expansionMap,c=e.compactProof;try{var u=this;return Promise.resolve(i((function(){return Promise.resolve(u.createVerifyData({document:t,proof:r,documentLoader:n,expansionMap:a,compactProof:c})).then((function(e){return Promise.resolve(u.getVerificationMethod({proof:r,document:t,documentLoader:n,expansionMap:a})).then((function(i){return Promise.resolve(u.verifySignature({verifyData:e,verificationMethod:i,document:t,proof:r,documentLoader:n,expansionMap:a})).then((function(e){if(!e)throw new Error("Invalid signature.");return Promise.resolve(o.validate(r,{document:t,suite:u,verificationMethod:i,documentLoader:n,expansionMap:a})).then((function(e){if(!e.valid)throw e.error;return{verified:!0,purposeResult:e}}))}))}))}))}),(function(e){return{verified:!1,error:e}})))}catch(e){return Promise.reject(e)}},e}();Object.keys(r).forEach((function(e){"default"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return r[e]}})})),exports.Ed25519Signature2018=s;
//# sourceMappingURL=ed25519-signature-2018.cjs.production.min.js.map
